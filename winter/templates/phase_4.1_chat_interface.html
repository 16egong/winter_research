<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Messenger of {{username}}</title>
            
        <!-- Custom css for chat pages -->
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/phase_4.1_chat_interface.css') }}">

        <!-- SocketIO JS -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>

        <!-- AJAX -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

        <!-- Notes JS -->
        <script type="text/javascript" src="{{ url_for('static', filename='scripts/notes.js') }}"></script>

        <!-- Custom SocketIO JS -->
        <script type="text/javascript">
            const uid = `{{uid}}`;
            const username = `{{username}}`;
            const posts = `{{posts}}`;
            const usernames = `{{usernames}}`
            const notesurl = `{{url_for("save_notes")}}`;
            var room = `{{room}}`
        </script>
    </head>

    <body>
        <main class="content">
            <section class="left-side">
                <section class="instructions">
                    <embed src="{{ url_for('static', filename='imgs/qualifications.png') }}" type="application/pdf" width="90%" height="400px" />
                </section>
                <section class="cv">
                    <iframe src="{{ url_for('static', filename='imgs/CVs.pdf') }}" type="application/pdf" width="100%" height="500px"></iframe>
                </section>
            </section>
            <section class="right-side">
                <!-- Notes start -->
                <section class="notes">
                    <header class="notes-header">
                        <p>Note Taking</p>
                    </header>
                    <main class="note-taking">
                        <textarea id="note-textbox" rows="20" cols="50">{{ notes }}</textarea>
                    </main>
                </section>
                <!-- Notes end -->

                <!-- Messenger start -->
                <section class="msger">
                    <!-- Header start -->
                    <header class="msger-header">
                        <div class="msger-header-title">
                            <i class="fas fa-comment-alt"></i> Winter Research
                        </div>
                    </header>
                    <!-- Header end -->

                    <!-- Main section start -->
                    <main id ="messages" class="msger-chat">
                        <!-- Display message start-->
                            {% for p in posts %} 
                                {% if  p.username == username %}
                                    <!-- Right message start-->
                                    <div class="msg right-msg">
                                        {% if p.uid == 1 or p.uid == 2 %}
                                            <div
                                               class="msg-img"
                                               style="background-image: url(https://imagesvc.meredithcorp.io/v3/mm/image?url=https%3A%2F%2Fcdn-image.travelandleisure.com%2Fsites%2Fdefault%2Ffiles%2Fstyles%2F1600x1000%2Fpublic%2Fblue0517.jpg%3Fitok%3DV3825voJ&w=400&c=sc&poi=face&q=85)">
                                            </div>
                                        {% else %}
                                            <div
                                               class="msg-img"
                                               style="background-image: url(https://www.macmillandictionary.com/external/slideshow/full/Lime%20Green_full.png)">
                                            </div>
                                        {% endif %}
                                        <!-- Right message bubble start-->
                                        <div class="msg-bubble">
                                            <!-- Right message info start -->
                                            <div class="msg-info">
                                                <div class="msg-info-name">{{ p.username }}</div>
                                                <div class="msg-info-time">{{ p.time }}</div>
                                            </div>
                                            <!-- Right message info end -->
                                            <!-- Right message bubble text-start -->
                                            <div class="msg-text">
                                                <p class="message">{{ p.body }}</p>
                                            </div>
                                            <!-- Right message bubble text end-->
                                        </div>
                                        <!-- Right message bubble end-->
                                    </div>
                                    <!-- Right message end-->
                                {% else %}
                                    <!-- Left message start-->
                                    <div class="is_typing">
                                        <em id="user-is-typing"></em>
                                    </div>
                                    <div class="msg left-msg">
                                        <!-- Left message bubble start-->
                                        {% if p.uid == 1 or p.uid == 2 %}
                                            <div
                                               class="msg-img"
                                               style="background-image: url(https://imagesvc.meredithcorp.io/v3/mm/image?url=https%3A%2F%2Fcdn-image.travelandleisure.com%2Fsites%2Fdefault%2Ffiles%2Fstyles%2F1600x1000%2Fpublic%2Fblue0517.jpg%3Fitok%3DV3825voJ&w=400&c=sc&poi=face&q=85)">
                                            </div>
                                        {% else %}
                                            <div
                                               class="msg-img"
                                               style="background-image: url(https://www.macmillandictionary.com/external/slideshow/full/Lime%20Green_full.png)">
                                            </div>
                                        {% endif %}
                                        <div class="msg-bubble">
                                            <!-- Left message info start -->
                                            <div class="msg-info">
                                                <div class="msg-info-name">{{ p.username }}</div>
                                                <div class="msg-info-time">{{ p.time }}</div>
                                            </div>
                                            <!-- Left message info end -->
                                            <!-- Left message bubble text-start -->
                                            <div class="msg-text">
                                                <p class="message">{{ p.body }}</p>
                                            </div>
                                            <!-- Right message bubble text end-->
                                        </div>
                                        <!-- Left message bubble end-->
                                    </div>
                                    <!-- Left message end-->
                                {% endif %}
                            {% endfor %}
                        <!-- Display message end -->
                    </main>
                    <!-- Main section end -->
                    <!-- Typing status start -->
                    <div id="typing_on1"></div>
                    <div id="typing_on2"></div>
                    <div id="typing_on3"></div>
                    <div id="typing_on4"></div>
                    <!-- Typing status end -->
                    <!-- Type message start -->
                    <div class="msger-inputarea" id="inputs">
                        <input type="text" class="msger-input" id="user-message" placeholder="Type here..." autocomplete="off">
                        <button type="button" class="msger-send-btn" id="send-message">SEND</button>
                    </div>
                    <!-- Type message end -->
                </section>
                <!-- Messenger end -->
            </section>
        </main>
        <footer class="chat-phase-4">
            <button class="survey-phase-4-btn"type="button" onclick="window.location.href = '{{url_for('phase_4_survey')}}';">Next (Survey Page Link)</button>
        </footer>
        
        <!-- Custom SocketIO JS -->
        <script src="{{url_for('static', filename='scripts/socketio.js')}}"></script>    
        <script src="{{url_for('static', filename='scripts/chat.js')}}"></script>    
    </body>
</html>